#!/usr/bin/make -f


dist: gen

# aclocal won't find libtool's m4, at least in debian, unless an
# extra include path is given, with libtoolize it is "." while
# whitout it is /usr/share/libtool/m4, altough it will fail
# on finding ltmain.sh

gen:
	libtoolize
	intltoolize
	aclocal -I .
	autoconf
	autoheader
	automake --add-missing --foreign

help:
	@echo "This file is used to aid in the setup of the build"
	@echo "environment, there are the following available targets"
	@echo "(use ./dist TARGET):"
	@echo "    gen        (default) Create the required structure"
	@echo "    clean      Remove the files created by gen and by the build process"
	@echo "    update-po  Update the language files with new translation or moved "
	@echo "               string locations (note it also updates the meta-timestamp)"
	@echo "               so it can get funny issuing this command when using CVS/SVN"
	@echo "    regen      'clean' then 'gen'"
	@echo "    help       This very message"


update-po:
	cd po && intltool-update -p
	cd po && for file in *.po ; do \
		intltool-update --dist `basename $$file .po` ; \
	done

regen: clean gen

clean:
	make distclean || true
	make clean || true
	cd src && make clean || true
	#
	rm -rf autom4te.cache
	rm -f config.* depcomp install-sh missing src/config.h src/config.h.in
	rm -f aclocal.m4
	rm -f configure Makefile Makefile.in src/Makefile src/Makefile.in
	rm -f po/*.gmo po/Makefile po/Makefile.in po/POTFILES
	find . -name 'stamp-??' -exec rm {} \;
	# The following are moved thanks to Makefile.am (var DISTCLEANFILES)
	# (kept for situations in which make distclean fails)
	# Undo libtoolize
	rm -f libtool.m4 lt*.m4 ltmain.sh libtool
	# Undo intltoolize
	rm -f intltool*
	rm -f po/Makefile.in.in
